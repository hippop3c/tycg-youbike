<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æ¡ƒåœ’å¸‚ YouBike å³æ™‚è³‡è¨Š</title>

<style>
body {
  font-family: Arial, "å¾®è»Ÿæ­£é»‘é«”";
  margin: 16px;
}

h2 {
  margin-bottom: 6px;
}

#status {
  margin-bottom: 10px;
}

table {
  border-collapse: collapse;
  width: 100%;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

th {
  background-color: #f2f2f2;
}

.zero {
  background-color: #ffd6d6;
  color: #b00000;
  font-weight: bold;
}
</style>
</head>

<body>

<h2>ğŸš² æ¡ƒåœ’å¸‚ YouBike å³æ™‚è³‡è¨Š</h2>
<div id="status">æ›´æ–°ä¸­â€¦</div>

<table>
<thead>
<tr>
  <th>ç«™å</th>
  <th>è¡Œæ”¿å€</th>
  <th>å¯å€Ÿ</th>
  <th>å¯é‚„</th>
</tr>
</thead>
<tbody id="data"></tbody>
</table>

<script>
/* âœ… æ¡ƒåœ’å¸‚æ”¿åºœæ­£å¼ Open Data APIï¼ˆå‰ç«¯å¯ç›´æ¥æŠ“ï¼‰ */
const API_URL =
  "https://data.tycg.gov.tw/opendata/datalist/datasetMeta/download?id=5ca2bfc7-9ace-4719-88ae-4034b9a5a55c&format=json";

async function loadData() {
  try {
    const res = await fetch(API_URL, { cache: "no-store" });
    const data = await res.json();

    const tbody = document.getElementById("data");
    tbody.innerHTML = "";

    data.forEach(st => {
      if (st.act !== "1") return;

      const tr = document.createElement("tr");

      const sbiZero = Number(st.sbi) === 0 ? "zero" : "";
      const bempZero = Number(st.bemp) === 0 ? "zero" : "";

      tr.innerHTML = `
        <td>${st.sna}</td>
        <td>${st.sarea}</td>
        <td class="${sbiZero}">${st.sbi}</td>
        <td class="${bempZero}">${st.bemp}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("status").innerText =
      "æœ€å¾Œæ›´æ–°ï¼š" + (data[0]?.mday || "");

  } catch (err) {
    document.getElementById("status").innerText =
      "è³‡æ–™è¼‰å…¥å¤±æ•—ï¼ˆè«‹é‡æ–°æ•´ç†ï¼‰";
    console.error(err);
  }
}

/* åˆæ¬¡è¼‰å…¥ */
loadData();

/* æ¯ 60 ç§’æ›´æ–° */
setInterval(loadData, 60000);
</script>

</body>
</html>
